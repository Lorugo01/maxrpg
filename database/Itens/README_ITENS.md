# Sistema de Itens e Equipamentos - D&D 5e

## üìã Estrutura de Arquivos

### Arquivos:
1. **`README_ITENS.md`** - Este arquivo de documenta√ß√£o
2. **`itens.sql`** - Exemplo de itens j√° inseridos (60 itens)

## üéØ Duas Tabelas Distintas

### 1. **`items`** - Itens de Personagem
Itens que pertencem a um personagem espec√≠fico (invent√°rio pessoal).

### 2. **`equipment`** - Equipamentos do Jogo
Cat√°logo geral de equipamentos dispon√≠veis no jogo (armas, armaduras, ferramentas, etc.).

---

## üìä Tabela `items` (Itens de Personagem)

### Estrutura:
| Campo | Tipo | Descri√ß√£o | Obrigat√≥rio |
|-------|------|-----------|-------------|
| `id` | UUID | Identificador √∫nico | ‚ùå (auto) |
| `character_id` | UUID | ID do personagem (FK) | ‚ùå N√£o |
| `name` | VARCHAR(100) | Nome do item | ‚úÖ Sim |
| `description` | TEXT | Descri√ß√£o do item | ‚ùå N√£o |
| `quantity` | INTEGER | Quantidade | ‚ùå (default: 1) |
| `weight` | NUMERIC(5,2) | Peso em libras | ‚ùå (default: 0) |
| `value` | NUMERIC(10,2) | Valor em PO | ‚ùå (default: 0) |
| `type` | VARCHAR(50) | Tipo do item | ‚úÖ Sim |
| `equipped` | BOOLEAN | Se est√° equipado | ‚ùå (default: false) |
| `created_at` | TIMESTAMP | Data de cria√ß√£o | ‚ùå (auto) |
| `updated_at` | TIMESTAMP | Data de atualiza√ß√£o | ‚ùå (auto) |

### Caracter√≠sticas:
- ‚úÖ **Foreign Key:** `character_id` ‚Üí `characters.id` (CASCADE on delete)
- ‚úÖ **√çndice:** `idx_items_character_id` para busca r√°pida
- ‚úÖ **Trigger:** `update_items_updated_at` atualiza `updated_at` automaticamente

---

## üìä Tabela `equipment` (Equipamentos do Jogo)

### Estrutura Completa:
| Campo | Tipo | Descri√ß√£o | Uso |
|-------|------|-----------|-----|
| `id` | UUID | Identificador √∫nico | Todos |
| `name` | VARCHAR(100) | Nome do equipamento | Todos |
| `type` | VARCHAR(50) | Tipo (Arma, Armadura, etc.) | Todos |
| `category` | VARCHAR(50) | Categoria espec√≠fica | Opcional |
| `cost` | NUMERIC(10,2) | Custo num√©rico | Opcional |
| `cost_text` | VARCHAR | Custo em texto | Opcional |
| `cost_currency` | VARCHAR | Moeda (PO, PP, PC, etc.) | Opcional |
| `weight` | NUMERIC(5,2) | Peso num√©rico | Opcional |
| `weight_text` | VARCHAR | Peso em texto | Opcional |
| `description` | TEXT | Descri√ß√£o completa | Opcional |
| `source` | VARCHAR | Fonte (PHB 2024, etc.) | Opcional |

### Campos Espec√≠ficos de Armas:
| Campo | Tipo | Descri√ß√£o |
|-------|------|-----------|
| `damage` | VARCHAR(50) | Dado de dano (1d6, 1d8, etc.) |
| `damage_type` | VARCHAR(50) | Tipo de dano (Cortante, Perfurante, etc.) |
| `properties` | VARCHAR(200) | Propriedades da arma |
| `weapon_properties` | TEXT | Propriedades detalhadas |
| `weapon_mastery` | VARCHAR | Maestria da arma (PHB 2024) |
| `is_ranged` | BOOLEAN | Se √© arma de longo alcance |
| `thrown_range` | VARCHAR | Alcance de arremesso (ex: 20/60) |

### Campos Espec√≠ficos de Armaduras:
| Campo | Tipo | Descri√ß√£o |
|-------|------|-----------|
| `armor_class` | INTEGER | CA base da armadura |
| `armor_class_modifier` | VARCHAR(50) | Modificador de CA (Destreza, etc.) |
| `stealth_disadvantage` | BOOLEAN | Se imp√µe desvantagem em Furtividade |
| `strength` | INTEGER | For√ßa m√≠nima requerida |
| `stealth` | VARCHAR(50) | Informa√ß√µes de furtividade |
| `attribute_requirements` | JSONB | Requisitos de atributos |
| `required_attributes` | TEXT | Atributos requeridos em texto |

### Caracter√≠sticas:
- ‚úÖ **√çndices:** `idx_equipment_type` e `idx_equipment_category` para busca r√°pida
- ‚úÖ **Trigger:** `update_equipment_updated_at` atualiza `updated_at` automaticamente

---

## üóÇÔ∏è Tipos de Equipamentos

### Armas:
- **Arma Simples** - Armas b√°sicas (Clava, Adaga, Lan√ßa, etc.)
- **Arma Marcial** - Armas avan√ßadas (Espada Longa, Machado Grande, etc.)

### Armaduras:
- **Armadura Leve** - CA + mod. Destreza completo (Couro, Acolchoada)
- **Armadura M√©dia** - CA + mod. Destreza (m√°x +2)
- **Armadura Pesada** - CA fixo, sem mod. Destreza

### Outros:
- **Item de Aventura** - Equipamentos gerais (Mochila, Corda, Tocha, etc.)
- **Instrumento Musical** - Instrumentos para bardos
- **Ferramenta** - Ferramentas de artes√£o
- **Foco em conjura√ß√£o** - Focos arcanos e divinos

---

## üí∞ Moedas do Sistema

| Moeda | Nome | Valor em PO |
|-------|------|-------------|
| **PC** | Pe√ßa de Cobre | 0,01 PO |
| **PP** | Pe√ßa de Prata | 0,1 PO |
| **PE** | Pe√ßa de Electrum | 0,5 PO |
| **PO** | Pe√ßa de Ouro | 1 PO |
| **PL** | Pe√ßa de Platina | 10 PO |

---

## üéØ Propriedades de Armas (PHB 2024)

### Propriedades B√°sicas:
- **Acuidade** - Pode usar Destreza ao inv√©s de For√ßa
- **Arremesso** - Pode ser arremessada
- **Duas M√£os** - Requer duas m√£os
- **Leve** - Arma leve para duas armas
- **Pesada** - Criaturas Pequenas t√™m desvantagem
- **Vers√°til** - Pode usar uma ou duas m√£os

### Maestrias de Armas (PHB 2024):
- **√Ågil** - +2 CA at√© pr√≥ximo turno
- **Afligir** - Desvantagem no pr√≥ximo ataque do alvo
- **Empurrar** - Empurra 3 metros
- **Lentid√£o** - Reduz velocidade
- **Trespassar** - Dano em criatura adjacente

---

## üìù Exemplos de Equipamentos

### Arma Simples:
```sql
INSERT INTO equipment (
  name, type, cost, cost_text, cost_currency, weight, weight_text,
  damage, damage_type, weapon_properties, weapon_mastery, 
  thrown_range, source
) VALUES (
  'Adaga',
  'Arma Simples',
  2.00, '2', 'PO',
  1.00, '1',
  '1d4', 'Perfurante',
  'Leve, Arremesso, Acuidade',
  '√Ågil',
  '20/60',
  'PHB 2024'
);
```

### Armadura Leve:
```sql
INSERT INTO equipment (
  name, type, cost, cost_text, cost_currency, weight, weight_text,
  armor_class, armor_class_modifier, stealth_disadvantage, source
) VALUES (
  'Armadura de couro',
  'Armadura Leve',
  10.00, '10', 'PO',
  10.00, '10',
  11, 'Destreza', false,
  'PHB 2024'
);
```

### Item de Aventura:
```sql
INSERT INTO equipment (
  name, type, cost, cost_text, cost_currency, weight, weight_text,
  description, source
) VALUES (
  'Mochila',
  'Item de Aventura',
  2.00, '2', 'PO',
  NULL, '',
  'Uma mochila suporta at√© 13,6 kg em 1 p√© c√∫bico. Ela tamb√©m pode servir como alforje.',
  'PHB 2024'
);
```

### Instrumento Musical:
```sql
INSERT INTO equipment (
  name, type, cost, cost_text, cost_currency, weight, weight_text,
  description, source
) VALUES (
  'Flauta',
  'Instrumento Musical',
  2.00, '2', 'PO',
  1.00, '1',
  'Habilidade: Carisma. Utilizar: Tocar uma melodia conhecida (CD 10) ou improvisar uma m√∫sica (CD 15).',
  'PHB 2024'
);
```

---

## üîç Consultas √öteis

### Listar todos os equipamentos:
```sql
SELECT name, type, cost_text, cost_currency, weight_text
FROM equipment
ORDER BY type, name;
```

### Buscar armas:
```sql
SELECT name, damage, damage_type, weapon_properties, weapon_mastery
FROM equipment
WHERE type LIKE '%Arma%'
ORDER BY type, name;
```

### Buscar armaduras:
```sql
SELECT name, type, armor_class, armor_class_modifier, stealth_disadvantage
FROM equipment
WHERE type LIKE '%Armadura%'
ORDER BY armor_class;
```

### Buscar por tipo espec√≠fico:
```sql
SELECT name, cost_text, cost_currency, description
FROM equipment
WHERE type = 'Instrumento Musical'
ORDER BY name;
```

### Listar itens de um personagem:
```sql
SELECT i.name, i.quantity, i.weight, i.value, i.equipped
FROM items i
WHERE i.character_id = 'uuid-do-personagem'
ORDER BY i.equipped DESC, i.name;
```

### Calcular peso total do invent√°rio:
```sql
SELECT 
  SUM(weight * quantity) as peso_total
FROM items
WHERE character_id = 'uuid-do-personagem';
```

### Calcular valor total do invent√°rio:
```sql
SELECT 
  SUM(value * quantity) as valor_total
FROM items
WHERE character_id = 'uuid-do-personagem';
```

---

## üìä Estat√≠sticas dos Itens Existentes

### Por Tipo (60 itens no exemplo):
- **Arma Simples:** ~10 itens
- **Arma Marcial:** ~2 itens
- **Armadura Leve:** ~2 itens
- **Item de Aventura:** ~25 itens
- **Instrumento Musical:** ~10 itens
- **Ferramenta:** ~3 itens
- **Foco em conjura√ß√£o:** ~4 itens
- **Outro:** ~4 itens

---

## ‚ö†Ô∏è Notas Importantes

### 1. **Diferen√ßa entre `items` e `equipment`:**
- `equipment`: Cat√°logo geral (biblioteca de itens)
- `items`: Invent√°rio do personagem (inst√¢ncias)

### 2. **Campos Duplicados:**
- `cost` (num√©rico) e `cost_text` (texto)
- `weight` (num√©rico) e `weight_text` (texto)
- Use os campos num√©ricos para c√°lculos
- Use os campos texto para exibi√ß√£o

### 3. **Moedas:**
- Sempre especifique `cost_currency`
- Convers√£o: 1 PO = 10 PP = 100 PC

### 4. **Peso:**
- Sempre em **libras**, n√£o quilos
- 1 libra ‚âà 0,45 kg
- NULL ou vazio = sem peso significativo

### 5. **PHB 2024 vs PHB 2014:**
- PHB 2024 tem **Maestrias de Armas**
- PHB 2024 tem propriedades atualizadas
- Sempre especifique a `source`

---

## üöÄ Como Executar

### üì¶ No Supabase (Recomendado):

**üìñ Consulte o guia completo:** [`GUIA_SUPABASE.md`](./GUIA_SUPABASE.md)

**Resumo r√°pido:**
1. **Acesse o SQL Editor** no painel do Supabase
2. **Copie e cole** o conte√∫do dos arquivos na ordem:
   - `insert_equipment_phb2024_parte1.sql` (~80 itens)
   - `insert_equipment_phb2024_parte2.sql` (~50 itens)
   - `insert_equipment_phb2024_parte3.sql` (~50 itens)
   - `insert_equipment_phb2024_parte4.sql` (~50 itens)
3. **Execute** cada script separadamente (RUN)
4. **Verifique** os resultados com as queries de verifica√ß√£o

‚ö†Ô∏è **Importante:** Execute os scripts **na ordem** para evitar problemas de depend√™ncias.

### üíª Via psql Local:

### Inserir Todos os Equipamentos:
```sql
-- Inser√ß√£o completa (~320 itens)
\i database/Itens/insert_all_equipment_phb2024.sql
```

### üßπ Limpeza de Duplicados:
Se voc√™ executou os scripts m√∫ltiplas vezes e tem itens duplicados:

**No Supabase (SQL Editor):**
```sql
-- Copie e cole o conte√∫do de cleanup_duplicates_supabase.sql
-- no SQL Editor do Supabase e execute
```

**Via psql local:**
```sql
\i database/Itens/cleanup_duplicates.sql
```

### üîç Verificar Duplicados Manualmente:
```sql
-- Listar todos os duplicados
SELECT 
  name,
  type,
  COUNT(*) as duplicatas
FROM equipment 
WHERE source = 'PHB 2024'
GROUP BY name, type
HAVING COUNT(*) > 1
ORDER BY duplicatas DESC;

-- Ver detalhes dos duplicados
SELECT 
  name,
  type,
  cost,
  created_at,
  id
FROM equipment 
WHERE source = 'PHB 2024'
  AND (name, type) IN (
    SELECT name, type
    FROM equipment 
    WHERE source = 'PHB 2024'
    GROUP BY name, type
    HAVING COUNT(*) > 1
  )
ORDER BY name, type, created_at DESC;
```

Este script mestre executa automaticamente:
- **Parte 1:** Itens de Aventura, Ferramentas, Instrumentos e Focos (~40 itens)
- **Parte 2:** Armas, Armaduras, Muni√ß√µes, Comida/Bebida, Montarias e Ve√≠culos (~25 itens)

### Executar Partes Individuais:
```sql
-- Apenas Parte 1
\i database/Itens/insert_equipment_phb2024_parte1.sql

-- Apenas Parte 2
\i database/Itens/insert_equipment_phb2024_parte2.sql
```

### Verificar Inser√ß√£o:
```sql
SELECT type, COUNT(*) as quantidade
FROM equipment
WHERE source = 'PHB 2024'
GROUP BY type
ORDER BY type;
```

---

## üìñ Refer√™ncias

- **Tabela Items:** `public.items`
- **Tabela Equipment:** `public.equipment`
- **Screen:** `lib/screens/rules/edit/edit_item_screen.dart`
- **Foreign Key:** `items.character_id` ‚Üí `characters.id`
- **Triggers:** 
  - `update_items_updated_at`
  - `update_equipment_updated_at`

---

**Status:** ‚úÖ Sistema completo com scripts de inser√ß√£o em massa
**Itens Dispon√≠veis:** 
- 60 itens exemplo j√° no banco
- ~65 itens adicionais nos scripts de inser√ß√£o
- **Total: ~125 equipamentos do PHB 2024**
